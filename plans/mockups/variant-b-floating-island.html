<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avatar GUI ‚Äî Varianta B: Floating Island</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --obsidian: #0a0a0f;
    --slate-darker: #0f0f17;
    --slate-deep: #12121a;
    --slate-base: #13131b;
    --slate-dark: #16161f;
    --slate-mid: #1a1a2e;
    --slate-light: #2a2a42;
    --synapse: #6366f1;
    --pulse: #8b5cf6;
    --neural: #06b6d4;
    --text-primary: #f8fafc;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;
    --glass-bg: rgba(18, 18, 26, 0.92);
    --glass-border: rgba(42, 42, 66, 0.5);
    --transition-speed: 0.4s;
  }

  body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background: var(--obsidian);
    color: var(--text-primary);
    overflow: hidden;
    height: 100vh;
  }

  /* ===== HOST APPLICATION ===== */
  .host-app {
    height: 100vh;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity var(--transition-speed) ease;
  }
  .host-app.hidden { opacity: 0; pointer-events: none; }
  .host-content {
    text-align: center;
    opacity: 0.6;
  }
  .host-content h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--synapse), var(--neural));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .host-content p { color: var(--text-secondary); font-size: 1.1rem; }
  .host-grid {
    display: grid;
    grid-template-columns: repeat(3, 200px);
    gap: 16px;
    margin-top: 2rem;
  }
  .host-card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
  }
  .host-card-icon { font-size: 2rem; margin-bottom: 0.5rem; }
  .host-card-label { font-size: 0.85rem; color: var(--text-secondary); }

  /* ===== FAB BUTTON ===== */
  .fab {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--synapse), var(--pulse));
    border: 2px solid rgba(255,255,255,0.15);
    cursor: pointer;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 24px rgba(99, 102, 241, 0.4);
    transition: all 0.3s ease;
    overflow: hidden;
  }
  .fab:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 32px rgba(99, 102, 241, 0.6);
  }
  .fab.hidden { transform: scale(0); opacity: 0; pointer-events: none; }
  .fab-icon {
    font-size: 1.5rem;
    transition: transform 0.3s ease;
  }

  /* Notification dot on FAB */
  .fab-pulse {
    position: absolute;
    inset: -3px;
    border-radius: 50%;
    border: 2px solid var(--synapse);
    animation: fab-ring 2s ease-out infinite;
    opacity: 0;
  }
  .fab.notify .fab-pulse { opacity: 1; }
  @keyframes fab-ring {
    0% { transform: scale(1); opacity: 0.6; }
    100% { transform: scale(1.4); opacity: 0; }
  }

  /* ===== FLOATING PANEL ===== */
  .floating-panel {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 400px;
    height: 580px;
    z-index: 999;
    border-radius: 20px;
    background: var(--glass-bg);
    backdrop-filter: blur(32px) saturate(120%);
    border: 1px solid var(--glass-border);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.05);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transform-origin: bottom right;
    transform: scale(0);
    opacity: 0;
    transition: transform var(--transition-speed) cubic-bezier(0.16, 1, 0.3, 1),
                opacity 0.2s ease,
                width var(--transition-speed) ease,
                height var(--transition-speed) ease,
                bottom var(--transition-speed) ease,
                right var(--transition-speed) ease,
                border-radius var(--transition-speed) ease;
    pointer-events: none;
  }
  .floating-panel.open {
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }
  .floating-panel.fullscreen {
    width: 100vw;
    height: 100vh;
    bottom: 0;
    right: 0;
    border-radius: 0;
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }

  /* ===== PANEL HEADER WITH BUST ===== */
  .panel-header {
    position: relative;
    background: linear-gradient(180deg, rgba(99, 102, 241, 0.12) 0%, transparent 100%);
    border-bottom: 1px solid var(--glass-border);
    overflow: hidden;
  }

  /* Avatar bust in header */
  .header-bust-area {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding: 16px 16px 0;
    height: 120px;
    position: relative;
  }
  .header-bust {
    width: 100px;
    height: 120px;
    position: relative;
    overflow: hidden;
    border-radius: 0 0 50% 50%;
  }
  .header-bust svg {
    width: 100%;
    height: auto;
    position: absolute;
    bottom: -10%;
  }

  /* Glow behind bust */
  .header-bust-glow {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 80px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(99,102,241,0.2) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.5s;
    pointer-events: none;
  }
  .header-bust-glow.active {
    opacity: 1;
    animation: glow-pulse 2s ease-in-out infinite;
  }
  @keyframes glow-pulse {
    0%, 100% { opacity: 0.5; transform: translateX(-50%) scale(1); }
    50% { opacity: 1; transform: translateX(-50%) scale(1.2); }
  }

  .header-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
  }
  .header-info-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .avatar-name {
    font-size: 0.9rem;
    font-weight: 600;
  }
  .avatar-status {
    font-size: 0.7rem;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #22c55e;
  }
  .status-dot.thinking {
    background: var(--synapse);
    animation: dot-pulse 1s ease infinite;
  }
  .status-dot.speaking {
    background: var(--pulse);
    animation: dot-pulse 0.5s ease infinite;
  }
  .status-dot.error {
    background: #ef4444;
  }
  @keyframes dot-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .header-controls {
    display: flex;
    gap: 4px;
  }
  .h-btn {
    width: 28px;
    height: 28px;
    border: none;
    background: rgba(255,255,255,0.06);
    color: var(--text-muted);
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    transition: all 0.2s;
  }
  .h-btn:hover {
    background: rgba(255,255,255,0.12);
    color: var(--text-primary);
  }

  /* ===== BUST ANIMATIONS ===== */
  .header-bust[data-state="idle"] svg {
    animation: bust-breathe 3s ease-in-out infinite;
  }
  .header-bust[data-state="thinking"] svg {
    animation: bust-thinking 2.5s ease-in-out infinite;
    filter: drop-shadow(0 0 12px rgba(99, 102, 241, 0.4));
  }
  .header-bust[data-state="speaking"] svg {
    animation: bust-speaking 1.5s ease-in-out infinite;
    filter: drop-shadow(0 0 15px rgba(139, 92, 246, 0.4));
  }
  .header-bust[data-state="error"] svg {
    animation: bust-shake 0.5s ease;
    filter: drop-shadow(0 0 12px rgba(239, 68, 68, 0.4));
  }

  @keyframes bust-breathe {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-2px) scale(1.005); }
  }
  @keyframes bust-thinking {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-4px) rotate(-1deg); }
    75% { transform: translateY(-2px) rotate(1deg); }
  }
  @keyframes bust-speaking {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.01); }
  }
  @keyframes bust-shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-5px); }
    40% { transform: translateX(5px); }
    60% { transform: translateX(-3px); }
    80% { transform: translateX(3px); }
  }

  /* ===== MESSAGES ===== */
  .messages-area {
    flex: 1;
    overflow-y: auto;
    padding: 12px 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .messages-area::-webkit-scrollbar { width: 4px; }
  .messages-area::-webkit-scrollbar-thumb {
    background: var(--slate-light);
    border-radius: 2px;
  }

  .message {
    display: flex;
    gap: 8px;
    max-width: 85%;
    animation: msg-in 0.3s ease;
  }
  .message.user { align-self: flex-end; flex-direction: row-reverse; }
  .message.assistant { align-self: flex-start; }

  .msg-avatar {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
  }
  .msg-avatar.user-av { background: linear-gradient(135deg, var(--synapse), var(--pulse)); }
  .msg-avatar.ai-av { background: var(--slate-mid); border: 1px solid var(--glass-border); }

  .msg-bubble {
    padding: 8px 12px;
    border-radius: 14px;
    font-size: 0.85rem;
    line-height: 1.45;
  }
  .message.user .msg-bubble {
    background: linear-gradient(135deg, rgba(99,102,241,0.2), rgba(139,92,246,0.2));
    border: 1px solid rgba(99,102,241,0.2);
  }
  .message.assistant .msg-bubble {
    background: rgba(26, 26, 46, 0.6);
    border: 1px solid var(--glass-border);
  }

  .typing-indicator {
    display: flex;
    gap: 4px;
    padding: 10px 14px;
    align-self: flex-start;
  }
  .typing-indicator span {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--synapse);
    animation: typing-bounce 1.4s ease-in-out infinite;
  }
  .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
  .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes typing-bounce {
    0%, 80%, 100% { transform: scale(0.6); opacity: 0.3; }
    40% { transform: scale(1); opacity: 1; }
  }

  @keyframes msg-in {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== INPUT AREA ===== */
  .input-area {
    padding: 8px 12px 12px;
    border-top: 1px solid var(--glass-border);
  }
  .input-container {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background: rgba(26, 26, 46, 0.5);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    transition: border-color 0.2s;
  }
  .input-container:focus-within {
    border-color: rgba(99, 102, 241, 0.5);
  }
  .msg-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text-primary);
    font-size: 0.85rem;
    font-family: inherit;
  }
  .msg-input::placeholder { color: var(--text-muted); }
  .input-btn {
    width: 32px;
    height: 32px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .attach-btn { background: transparent; color: var(--text-muted); font-size: 0.85rem; }
  .attach-btn:hover { color: var(--text-primary); }
  .send-btn {
    background: linear-gradient(135deg, var(--synapse), var(--pulse));
    color: white;
    font-size: 0.85rem;
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
  }
  .send-btn:hover { transform: scale(1.05); }

  /* ===== FULLSCREEN SPECIFIC ===== */
  .floating-panel.fullscreen .header-bust-area {
    height: 80px;
  }
  .floating-panel.fullscreen .header-bust {
    width: 70px;
    height: 80px;
  }
  .floating-panel.fullscreen .messages-area {
    max-width: 800px;
    margin: 0 auto;
    width: 100%;
    padding: 20px 24px;
  }
  .floating-panel.fullscreen .input-area {
    max-width: 800px;
    margin: 0 auto;
    width: 100%;
    padding: 12px 24px 16px;
  }

  /* ===== CONTROLS PANEL ===== */
  .controls-panel {
    position: fixed;
    top: 16px;
    left: 16px;
    z-index: 3000;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-width: 240px;
  }
  .controls-title {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
  }
  .control-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .control-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
    width: 60px;
    flex-shrink: 0;
  }
  .control-buttons { display: flex; gap: 4px; flex-wrap: wrap; }
  .ctrl-btn {
    padding: 4px 10px;
    border: 1px solid var(--glass-border);
    background: rgba(26, 26, 46, 0.5);
    color: var(--text-secondary);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.75rem;
    font-family: inherit;
    transition: all 0.2s;
  }
  .ctrl-btn:hover {
    background: rgba(99, 102, 241, 0.15);
    border-color: rgba(99, 102, 241, 0.3);
    color: var(--text-primary);
  }
  .ctrl-btn.active {
    background: rgba(99, 102, 241, 0.25);
    border-color: var(--synapse);
    color: var(--synapse);
  }

  .variant-label {
    position: fixed;
    top: 16px;
    right: 16px;
    z-index: 3000;
    padding: 8px 16px;
    background: linear-gradient(135deg, var(--neural), #0891b2);
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
  }
  .variant-label small {
    display: block;
    font-weight: 400;
    opacity: 0.8;
    font-size: 0.65rem;
    margin-top: 2px;
  }
</style>
</head>
<body>

<div class="variant-label">
  VARIANTA B: Floating Island
  <small>Plovouc√≠ panel vpravo dole + bust v headeru</small>
</div>

<div class="controls-panel">
  <div class="controls-title">Demo Controls</div>
  <div class="control-row">
    <span class="control-label">Mode:</span>
    <div class="control-buttons">
      <button class="ctrl-btn active" onclick="setMode('fab')">FAB</button>
      <button class="ctrl-btn" onclick="setMode('panel')">Panel</button>
      <button class="ctrl-btn" onclick="setMode('fullscreen')">Fullscreen</button>
    </div>
  </div>
  <div class="control-row">
    <span class="control-label">AI State:</span>
    <div class="control-buttons">
      <button class="ctrl-btn active" onclick="setState('idle')">Idle</button>
      <button class="ctrl-btn" onclick="setState('thinking')">Thinking</button>
      <button class="ctrl-btn" onclick="setState('speaking')">Speaking</button>
      <button class="ctrl-btn" onclick="setState('error')">Error</button>
    </div>
  </div>
  <div class="control-row">
    <span class="control-label">Demo:</span>
    <div class="control-buttons">
      <button class="ctrl-btn" onclick="runDemo()">Auto Demo</button>
    </div>
  </div>
</div>

<!-- HOST APPLICATION -->
<div class="host-app" id="hostApp">
  <div class="host-content">
    <h1>Host Application</h1>
    <p>Va≈°e hlavn√≠ aplikace zab√≠r√° celou obrazovku.</p>
    <p>Avatar Engine bƒõ≈æ√≠ jako plovouc√≠ panel nad n√≠.</p>
    <div class="host-grid">
      <div class="host-card"><div class="host-card-icon">üìä</div><div class="host-card-label">Dashboard</div></div>
      <div class="host-card"><div class="host-card-icon">üìù</div><div class="host-card-label">Editor</div></div>
      <div class="host-card"><div class="host-card-icon">‚öôÔ∏è</div><div class="host-card-label">Settings</div></div>
    </div>
  </div>
</div>

<!-- FAB -->
<div class="fab" id="fab" onclick="setMode('panel')">
  <span class="fab-icon">‚ú¶</span>
  <div class="fab-pulse"></div>
</div>

<!-- FLOATING PANEL -->
<div class="floating-panel" id="floatingPanel">
  <div class="panel-header">
    <div class="header-bust-area">
      <div class="header-bust-glow" id="bustGlow"></div>
      <div class="header-bust" id="headerBust" data-state="idle">
        <svg viewBox="0 0 200 260" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="suitG" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#c0c8d8"/>
              <stop offset="100%" stop-color="#8090a8"/>
            </linearGradient>
            <linearGradient id="accentG" x1="0" y1="0" x2="1" y2="0">
              <stop offset="0%" stop-color="#e07830"/>
              <stop offset="100%" stop-color="#c06020"/>
            </linearGradient>
            <linearGradient id="hairG" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#2a2a3a"/>
              <stop offset="100%" stop-color="#1a1a28"/>
            </linearGradient>
          </defs>
          <!-- Body -->
          <ellipse cx="100" cy="230" rx="65" ry="40" fill="url(#suitG)" stroke="#6080a0" stroke-width="1"/>
          <rect x="42" y="200" width="18" height="24" rx="4" fill="url(#accentG)" opacity="0.8"/>
          <rect x="140" y="200" width="18" height="24" rx="4" fill="url(#accentG)" opacity="0.8"/>
          <!-- Collar -->
          <ellipse cx="100" cy="172" rx="32" ry="10" fill="#7088a0"/>
          <!-- Neck -->
          <rect x="90" y="148" width="20" height="28" rx="5" fill="#f0d0a8"/>
          <!-- Head -->
          <ellipse cx="100" cy="105" rx="45" ry="55" fill="#f0d0a8"/>
          <!-- Hair -->
          <ellipse cx="100" cy="78" rx="47" ry="40" fill="url(#hairG)"/>
          <path d="M100 42 Q118 36 126 54 Q130 72 122 90" stroke="#2a2a3a" stroke-width="10" fill="none" stroke-linecap="round"/>
          <path d="M58 90 Q62 65 82 60 Q100 55 118 60 Q138 65 142 90" fill="url(#hairG)"/>
          <!-- Eyes -->
          <ellipse cx="82" cy="106" rx="7" ry="8" fill="white"/>
          <ellipse cx="118" cy="106" rx="7" ry="8" fill="white"/>
          <circle cx="82" cy="106" r="4.5" fill="#4060a0"/>
          <circle cx="118" cy="106" r="4.5" fill="#4060a0"/>
          <circle cx="80" cy="104" r="1.5" fill="white"/>
          <circle cx="116" cy="104" r="1.5" fill="white"/>
          <!-- Eyebrows -->
          <path d="M72 95 Q82 89 91 93" stroke="#2a2a3a" stroke-width="2.2" fill="none" stroke-linecap="round"/>
          <path d="M109 93 Q118 89 128 95" stroke="#2a2a3a" stroke-width="2.2" fill="none" stroke-linecap="round"/>
          <!-- Nose -->
          <path d="M97 114 Q100 121 103 114" stroke="#c0a080" stroke-width="1.3" fill="none"/>
          <!-- Mouth -->
          <g id="mouth">
            <path d="M90 130 Q100 136 110 130" stroke="#c07060" stroke-width="1.8" fill="none" stroke-linecap="round"/>
          </g>
          <!-- Badge -->
          <circle cx="122" cy="208" r="7" fill="#3060c0" opacity="0.8"/>
        </svg>
      </div>
    </div>
    <div class="header-info">
      <div class="header-info-left">
        <div>
          <div class="avatar-name">Astronautka</div>
          <div class="avatar-status">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Online</span>
          </div>
        </div>
      </div>
      <div class="header-controls">
        <button class="h-btn" onclick="setMode('fab')" title="Minimize">‚îÄ</button>
        <button class="h-btn" onclick="setMode('fullscreen')" title="Fullscreen">‚ñ°</button>
        <button class="h-btn" onclick="setMode('fab')" title="Close">√ó</button>
      </div>
    </div>
  </div>

  <div class="messages-area" id="messagesArea">
    <div class="message assistant">
      <div class="msg-avatar ai-av">‚ú¶</div>
      <div class="msg-bubble">Ahoj! Jsem tv≈Øj AI asistent. Jak ti mohu dnes pomoci?</div>
    </div>
    <div class="message user">
      <div class="msg-avatar user-av">T</div>
      <div class="msg-bubble">Vysvƒõtli mi, jak funguje WebSocket</div>
    </div>
    <div class="message assistant">
      <div class="msg-avatar ai-av">‚ú¶</div>
      <div class="msg-bubble">
        WebSocket je protokol pro obousmƒõrnou komunikaci mezi klientem a serverem.
        Na rozd√≠l od HTTP z≈Øst√°v√° spojen√≠ otev≈ôen√©, tak≈æe server m≈Ø≈æe aktivnƒõ pos√≠lat data klientovi.
      </div>
    </div>
  </div>

  <div class="input-area">
    <div class="input-container">
      <button class="input-btn attach-btn">üìé</button>
      <input class="msg-input" placeholder="Napi≈° zpr√°vu..." onkeydown="if(event.key==='Enter')simulateSend(this)">
      <button class="input-btn send-btn" onclick="simulateSend(document.querySelector('.msg-input'))">‚û§</button>
    </div>
  </div>
</div>

<script>
  let currentMode = 'fab';
  let currentState = 'idle';

  const fab = document.getElementById('fab');
  const panel = document.getElementById('floatingPanel');
  const hostApp = document.getElementById('hostApp');
  const headerBust = document.getElementById('headerBust');
  const bustGlow = document.getElementById('bustGlow');
  const statusDot = document.getElementById('statusDot');
  const statusText = document.getElementById('statusText');
  const mouth = document.getElementById('mouth');

  function setMode(mode) {
    currentMode = mode;
    document.querySelectorAll('.control-row:first-of-type .ctrl-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`.control-row:first-of-type .ctrl-btn[onclick="setMode('${mode}')"]`)?.classList.add('active');

    fab.classList.toggle('hidden', mode !== 'fab');
    panel.classList.remove('open', 'fullscreen');
    hostApp.classList.remove('hidden');

    if (mode === 'panel') {
      panel.classList.add('open');
    } else if (mode === 'fullscreen') {
      panel.classList.add('open', 'fullscreen');
      hostApp.classList.add('hidden');
    }
  }

  function setState(state) {
    currentState = state;
    headerBust.dataset.state = state;

    document.querySelectorAll('.control-row:nth-of-type(2) .ctrl-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`.control-row:nth-of-type(2) .ctrl-btn[onclick="setState('${state}')"]`)?.classList.add('active');

    statusDot.className = 'status-dot';
    if (state === 'thinking') {
      statusDot.classList.add('thinking');
      statusText.textContent = 'P≈ôem√Ω≈°l√≠...';
      bustGlow.classList.add('active');
    } else if (state === 'speaking') {
      statusDot.classList.add('speaking');
      statusText.textContent = 'Odpov√≠d√°...';
      bustGlow.classList.add('active');
      animateSpeaking();
    } else if (state === 'error') {
      statusDot.classList.add('error');
      statusText.textContent = 'Chyba';
      bustGlow.classList.remove('active');
    } else {
      statusText.textContent = 'Online';
      bustGlow.classList.remove('active');
    }
    updateMouth(state);
  }

  function updateMouth(state) {
    if (state === 'thinking') {
      mouth.innerHTML = '<path d="M92 132 L108 132" stroke="#c07060" stroke-width="1.8" stroke-linecap="round"/>';
    } else if (state === 'error') {
      mouth.innerHTML = '<path d="M90 136 Q100 128 110 136" stroke="#c07060" stroke-width="1.8" fill="none" stroke-linecap="round"/>';
    } else if (state !== 'speaking') {
      mouth.innerHTML = '<path d="M90 130 Q100 136 110 130" stroke="#c07060" stroke-width="1.8" fill="none" stroke-linecap="round"/>';
    }
  }

  let speakingInterval;
  const mouthFrames = [
    '<ellipse cx="100" cy="132" rx="5" ry="3" fill="#c07060"/>',
    '<ellipse cx="100" cy="132" rx="7" ry="5" fill="#c07060"/><ellipse cx="100" cy="133" rx="4" ry="2.5" fill="#901020"/>',
    '<ellipse cx="100" cy="132" rx="8" ry="7" fill="#c07060"/><ellipse cx="100" cy="134" rx="5" ry="3.5" fill="#901020"/>',
    '<ellipse cx="100" cy="132" rx="7" ry="5" fill="#c07060"/><ellipse cx="100" cy="133" rx="4" ry="2.5" fill="#901020"/>',
  ];
  let fIdx = 0, fDir = 1;

  function animateSpeaking() {
    clearInterval(speakingInterval);
    speakingInterval = setInterval(() => {
      if (currentState !== 'speaking') { clearInterval(speakingInterval); return; }
      mouth.innerHTML = mouthFrames[fIdx];
      fIdx += fDir;
      if (fIdx >= mouthFrames.length - 1) fDir = -1;
      if (fIdx <= 0) fDir = 1;
    }, 120);
  }

  function simulateSend(input) {
    if (!input.value.trim()) return;
    const text = input.value;
    input.value = '';
    const area = document.getElementById('messagesArea');
    area.innerHTML += `<div class="message user"><div class="msg-avatar user-av">T</div><div class="msg-bubble">${text}</div></div>`;
    setState('thinking');
    area.innerHTML += `<div class="typing-indicator" id="typingInd"><span></span><span></span><span></span></div>`;
    area.scrollTop = area.scrollHeight;
    setTimeout(() => {
      setState('speaking');
      const ti = document.getElementById('typingInd');
      if (ti) ti.outerHTML = `<div class="message assistant"><div class="msg-avatar ai-av">‚ú¶</div><div class="msg-bubble">To je skvƒõl√° ot√°zka! R√°d ti s t√≠m pomohu...</div></div>`;
      area.scrollTop = area.scrollHeight;
      setTimeout(() => setState('idle'), 2000);
    }, 1500);
  }

  function runDemo() {
    const steps = [
      () => setMode('fab'),
      () => { fab.classList.add('notify'); },
      () => setMode('panel'),
      () => setState('idle'),
      () => setState('thinking'),
      () => setState('speaking'),
      () => setState('idle'),
      () => setMode('fullscreen'),
      () => setState('thinking'),
      () => setState('speaking'),
      () => setState('idle'),
      () => setMode('panel'),
      () => setState('error'),
      () => setState('idle'),
      () => setMode('fab'),
    ];
    let i = 0;
    const iv = setInterval(() => {
      if (i >= steps.length) { clearInterval(iv); return; }
      steps[i++]();
    }, 1200);
  }
</script>
</body>
</html>
